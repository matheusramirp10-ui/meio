<!-- Firebase (modo compatível) -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>

<script>
  // Configuração do Firebase
  const firebaseConfig = {
    apiKey: "AIzaSyAZMTAu6spGpK5WAquIfc6lVdTYPy9HrOQ",
    authDomain: "teste-9b3da.firebaseapp.com",
    projectId: "teste-9b3da",
    storageBucket: "teste-9b3da.firebasestorage.app",
    messagingSenderId: "852843060670",
    appId: "1:852843060670:web:8c3bb1406943eb8f142def",
    measurementId: "G-F1L7VR6RWM"
  };

  // Inicializando Firebase
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();
  const storage = firebase.storage();

  // LOGIN ADMIN
  const PASS = "15390640";
  const btnLogin = document.getElementById('btnLogin');
  btnLogin.addEventListener('click', () => {
    const v = document.getElementById('adminPass').value;
    if(v === PASS){
      document.getElementById('loginPanel').style.display = "none";
      document.getElementById('editorPanel').style.display = "";
    }else{ alert("Senha incorreta!"); }
  });

  // ADICIONAR PRODUTO
  const btnAdd = document.getElementById('btnAddProduct');
  btnAdd.addEventListener('click', async () => {
    const name = document.getElementById('productName').value;
    const price = document.getElementById('productPrice').value;
    const category = document.getElementById('productCategory').value;
    const file = document.getElementById('productImage').files[0];

    if(!name || !price || !file){ alert("Preencha todos os campos"); return; }

    const storageRef = storage.ref('produtos/' + file.name);
    await storageRef.put(file);
    const imageUrl = await storageRef.getDownloadURL();

    await db.collection('products').add({ name, price, category, image: imageUrl });
    alert("Produto adicionado!");

    document.getElementById('productName').value = "";
    document.getElementById('productPrice').value = "";
    document.getElementById('productCategory').value = "";
    document.getElementById('productImage').value = "";

    renderProducts();
  });

  // RENDERIZAÇÃO DE PRODUTOS
  async function renderProducts(term="") {
    const snapshot = await db.collection('products').get();
    let products = snapshot.docs.map(doc => doc.data());
    if(term) products = products.filter(p => (p.name + " " + p.category).toLowerCase().includes(term.toLowerCase()));

    const grid = document.getElementById('productsGrid');
    grid.innerHTML = "";
    products.forEach(p => {
      const card = document.createElement('div');
      card.className = 'card';
      card.innerHTML = `
        <img src="${p.image}" alt="${p.name}" />
        <div class="body">
          <strong>${p.name}</strong>
          <span class="muted">${p.category}</span>
          <span class="price">R$ ${p.price}</span>
          <button class="buy" onclick="comprar('${p.name}')">Comprar</button>
        </div>
      `;
      grid.appendChild(card);
    });
  }

  renderProducts();

  // BUSCA
  document.getElementById('search').addEventListener('input', e => renderProducts(e.target.value));

  // WHATSAPP
  function comprar(nome){
    window.open('https://wa.me/5577981518721?text=' + encodeURIComponent("Olá, vim pelo site e quero fazer um pedido: " + nome), '_blank');
  }
</script>
